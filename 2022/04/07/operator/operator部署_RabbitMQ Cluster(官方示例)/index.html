<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Operator部署_RabbitMQ Cluster(官方示例)"><meta name="keywords" content="rabbitmq"><meta name="author" content="YuiKuen.Yuen"><meta name="copyright" content="YuiKuen.Yuen"><title>Operator部署_RabbitMQ Cluster(官方示例) | Mr.Yuen'Blog</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/favicon.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1359876433997feef3afed2ab6c5b39c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%A6%81%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">安装要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">安装介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operator-%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">Operator 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E5%88%9B%E5%BB%BA"><span class="toc-number">4.</span> <span class="toc-text">RabbitMQ 创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E7%9B%91%E6%8E%A7"><span class="toc-number">5.</span> <span class="toc-text">RabbitMQ 监控</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/20220407100042.png"></div><div class="author-info__name text-center">YuiKuen.Yuen</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/yuikuen">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">150</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">64</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">30</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com">Molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wallhaven-wqx3e7-tuya.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Mr.Yuen'Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Operator部署_RabbitMQ Cluster(官方示例)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-07</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/operator/">operator</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.3k</span><span class="post-meta__separator">|</span><span>Reading time: 17 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h3><ol>
<li>k8s 版本要 1.18 及其以上</li>
<li>能够在 master 节点上使用 kubectl 命令来管理整个 k8s 集群</li>
<li>有默认的一个 StorageClass 存储类，因为默认情况下 RabbitMQ Operator 创建的 RabbitMQ 集群会为每个实例使用 StorageClass 分配一个 10G 的 PVC。但是官方提供的yaml文件中并没有设置使用 StorageClass 存储类的配置，所以需要一个默认的 StorageClass 存储类。</li>
</ol>
<blockquote>
<p>若没有这个默认的 StorageClass 存储类，则创建 RabbitMQ 集群时创建的 pod 状态是 Pending，具体原因是：pod has unbound immediate PersistentVolumeClaims</p>
</blockquote>
<p>查看默认 StorageClass 储存类，注意 default</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get sc -o wide</span></span><br><span class="line">NAME                    PROVISIONER                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-164                 nfs-nfs-164                     Delete          WaitForFirstConsumer   <span class="literal">false</span>                  37d</span><br><span class="line">rook-ceph-block         rook-ceph.rbd.csi.ceph.com      Delete          Immediate              <span class="literal">true</span>                   24h</span><br><span class="line">rook-cephfs (default)   rook-ceph.cephfs.csi.ceph.com   Delete          Immediate              <span class="literal">true</span>                   23h</span><br><span class="line">storage                 nfs-storage                     Delete          WaitForFirstConsumer   <span class="literal">false</span>                  39d</span><br></pre></td></tr></table></figure>

<p>安装步骤</p>
<ul>
<li>安装 RabbitMQ 集群操作员</li>
<li>使用 RabbitMQ 集群操作员部署 RabbitMQ 集群</li>
<li>查看 RabbitMQ日志</li>
<li>访问 RabbitMQ 管理 UI</li>
<li>设置应用访问 RabbitMQ 集群</li>
</ul>
<h3 id="安装介绍"><a href="#安装介绍" class="headerlink" title="安装介绍"></a>安装介绍</h3><ul>
<li><p>第一种方式是采用插件的方式，详见地址：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1782766"> https://cloud.tencent.com/developer/article/1782766</a><br>需要先安装插件管理工具 krew，然后才能使用插件的方式进行安装。在安装的过程中会从 GitHub 上下载东西，访问 GitHub 慢的不建议采用这种方式</p>
</li>
<li><p>第二种方式是通过 yaml 文件的方式进行安装，这里采用这种方式进行</p>
</li>
</ul>
<h3 id="Operator-安装"><a href="#Operator-安装" class="headerlink" title="Operator 安装"></a>Operator 安装</h3><p>1）使用 yaml 文件的方式进行安装 cluster-operator ( <a target="_blank" rel="noopener" href="https://github.com/rabbitmq/cluster-operator/releases">yaml 文件下载地址</a> )</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl create -f cluster-operator.yaml       </span></span><br><span class="line">namespace/rabbitmq-system created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/rabbitmqclusters.rabbitmq.com created</span><br><span class="line">serviceaccount/rabbitmq-cluster-operator created</span><br><span class="line">role.rbac.authorization.k8s.io/rabbitmq-cluster-leader-election-role created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/rabbitmq-cluster-operator-role created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/rabbitmq-cluster-leader-election-rolebinding created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/rabbitmq-cluster-operator-rolebinding created</span><br><span class="line">deployment.apps/rabbitmq-cluster-operator created</span><br></pre></td></tr></table></figure>

<p>2）会创建一个新的名称空间：rabbitmq-system</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get all -n rabbitmq-system</span></span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/rabbitmq-cluster-operator-7c65454ff9-f52b2   1/1     Running   0          32m</span><br><span class="line"></span><br><span class="line">NAME                                        READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/rabbitmq-cluster-operator   1/1     1            1           32m</span><br><span class="line"></span><br><span class="line">NAME                                                   DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/rabbitmq-cluster-operator-7c65454ff9   1         1         1       32m</span><br></pre></td></tr></table></figure>

<p>3）通过上面的显示可以发现有个一脉相承的如下关系：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">资源类型：deployment =》 replicaset =》 pod</span><br><span class="line">具体名称 ：rabbitmq-cluster-operator =》rabbitmq-cluster-operator-7c65454ff9 =》rabbitmq-cluster-operator-7c65454ff9-td2pm</span><br></pre></td></tr></table></figure>

<p>4）新的自定义资源 rabbitmqclusters.rabbitmq.com。自定义资源允许我们定义用于创建 RabbitMQ 集群的 API。以及一些 rbac 角色。这些是操作员创建、更新和删除 RabbitMQ 集群所必需的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get customresourcedefinitions.apiextensions.k8s.io </span></span><br><span class="line">NAME                                             CREATED AT</span><br><span class="line">...</span><br><span class="line">rabbitmqclusters.rabbitmq.com                    2021-06-04T02:21:42Z</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="RabbitMQ-创建"><a href="#RabbitMQ-创建" class="headerlink" title="RabbitMQ 创建"></a>RabbitMQ 创建</h3><p>1）使用 cluster-operator 创建 RabbitMQ 集群</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rabbitmq/cluster-operator/tree/main/docs/examples/hello-world">简单的 yaml 文件模版</a>，这是最简单的 RabbitmqCluster 定义。唯一显示指定的属性是集群的名称。其他一切都将根据集群运营商的默认值进行配置。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rabbitmq/cluster-operator/tree/main/docs/examples/">examples 模版目录</a> 还有许多其他引用，比如用 TLS、mTLS 创建 RabbitMQ 集群，用生产默认值设置集群，添加社区插件等等。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat rabbitmq.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rabbitmq.com/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RabbitmqCluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbit-cluster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">rabbitmq-system</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：默认没有写名称空间则会部署到defalut中，这里修改成rabbitmq-system</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl create -f rabbitmq.yaml </span></span><br><span class="line">rabbitmqcluster.rabbitmq.com/my-rabbit-cluster created</span><br></pre></td></tr></table></figure>

<p>2）在 rabbitmq-system 命名空间中创建了一个名为 my-rabbit-cluster 的 RabbitMQ 集群。可以在创建 RabbitMQ 集群时看到它：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get pod -n rabbitmq-system</span></span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">my-rabbit-cluster-server-0                   1/1     Running   0          80s</span><br></pre></td></tr></table></figure>

<p>3）还可以看到创建的 rabbitmqclusters.rabbitmq.com 自定义资源的实例。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get rabbitmqclusters.rabbitmq.com -n rabbitmq-system</span></span><br><span class="line">NAME                AGE</span><br><span class="line">my-rabbit-cluster   2m33s</span><br></pre></td></tr></table></figure>

<p>4）查看 RabbitMQ 日志</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl logs my-rabbit-cluster-server-0 -n rabbitmq-system</span></span><br><span class="line"> Starting RabbitMQ 3.8.16 on Erlang 24.0.2</span><br><span class="line"> Copyright (c) 2007-2021 VMware, Inc. or its affiliates.</span><br><span class="line"> Licensed under the MPL 2.0. Website: https://rabbitmq.com</span><br><span class="line"></span><br><span class="line">  <span class="comment">##  ##      RabbitMQ 3.8.16</span></span><br><span class="line">  <span class="comment">##  ##</span></span><br><span class="line">  <span class="comment">##########  Copyright (c) 2007-2021 VMware, Inc. or its affiliates.</span></span><br><span class="line">  <span class="comment">######  ##</span></span><br><span class="line">  <span class="comment">##########  Licensed under the MPL 2.0. Website: https://rabbitmq.com</span></span><br><span class="line"></span><br><span class="line">  Doc guides: https://rabbitmq.com/documentation.html</span><br><span class="line">  Support:    https://rabbitmq.com/contact.html</span><br><span class="line">  Tutorials:  https://rabbitmq.com/getstarted.html</span><br><span class="line">  Monitoring: https://rabbitmq.com/monitoring.html</span><br><span class="line"></span><br><span class="line">  Logs: &lt;stdout&gt;</span><br><span class="line"></span><br><span class="line">  Config file(s): /etc/rabbitmq/rabbitmq.conf</span><br><span class="line">                  /etc/rabbitmq/conf.d/10-operatorDefaults.conf</span><br><span class="line">                  /etc/rabbitmq/conf.d/11-default_user.conf</span><br><span class="line">                  /etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf</span><br><span class="line"></span><br><span class="line">  Starting broker...2021-06-04 03:05:59.646 [info] &lt;0.273.0&gt; </span><br><span class="line"> node           : rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.rabbitmq-system</span><br><span class="line"> home <span class="built_in">dir</span>       : /var/lib/rabbitmq</span><br><span class="line"> config file(s) : /etc/rabbitmq/rabbitmq.conf</span><br><span class="line">                : /etc/rabbitmq/conf.d/10-operatorDefaults.conf</span><br><span class="line">                : /etc/rabbitmq/conf.d/11-default_user.conf</span><br><span class="line">                : /etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf</span><br><span class="line"> cookie <span class="built_in">hash</span>    : kH25nUaPr1ngafL6UipoTQ==</span><br><span class="line"> <span class="built_in">log</span>(s)         : &lt;stdout&gt;</span><br><span class="line"> database <span class="built_in">dir</span>   : /var/lib/rabbitmq/mnesia/rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.rabbitmq-system</span><br></pre></td></tr></table></figure>

<p>5）访问 RabbitMQ 管理 UI</p>
<p><strong>获取用户名和密码</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">username=<span class="string">&quot;<span class="subst">$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.username&#125;&#x27; | base64 --decode)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;username: <span class="variable">$username</span>&quot;</span>  </span><br><span class="line"></span><br><span class="line">password=<span class="string">&quot;<span class="subst">$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.password&#125;&#x27; | base64 --decode)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;password: <span class="variable">$password</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>默认会创建一个类型是 ClusterIP 的 svc</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl get svc -n rabbitmq-system</span></span><br><span class="line">NAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                        AGE</span><br><span class="line">my-rabbit-cluster         ClusterIP   10.3.255.186   &lt;none&gt;        5672/TCP,15672/TCP,15692/TCP   8m18s</span><br><span class="line">my-rabbit-cluster-nodes   ClusterIP   None           &lt;none&gt;        4369/TCP,25672/TCP             8m18s</span><br></pre></td></tr></table></figure>

<ul>
<li>办法一是修改 ClusterIP 类型为 NodePort，使用宿主机 IP 和 nodeport 端口来访问</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># kubectl edit svc my-rabbit-cluster -n rabbitmq-system</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注:这种方式一开始修改后是能够访问使用的，但是删除集群后重新创建并这样设置，就无法修改成 NodePort了，很是奇怪。</p>
</blockquote>
<ul>
<li>办法二是使用 kube-proxy 进行代理来实现访问</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl port-forward svc/my-rabbit-cluster 15672      </span></span><br><span class="line">Forwarding from 127.0.0.1:15672 -&gt; 15672</span><br><span class="line">Forwarding from [::1]:15672 -&gt; 15672</span><br></pre></td></tr></table></figure>

<p>现在我们可以通过 localhost:15672 在打开浏览器并查看管理 UI。或者，可以运行 curl 命令来验证访问：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -u<span class="variable">$username</span>:<span class="variable">$password</span> localhost:15672/api/overview</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@develop-master-1 ~]<span class="comment"># username=&quot;$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.username&#125;&#x27; | base64 --decode)&quot; &amp;&amp; echo &quot;username: $username&quot;</span></span><br><span class="line">username: YNbrfwcmEqnuJD6BZthuWZP9bTJQuYmW</span><br><span class="line">[root@develop-master-1 ~]<span class="comment"># password=&quot;$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.password&#125;&#x27; | base64 --decode)&quot; &amp;&amp; echo &quot;password: $password&quot;</span></span><br><span class="line">password: 88DzY3WQ51Q2Q9FfWJKrTaQpLUgSfeWP</span><br><span class="line">[root@develop-master-1 ~]<span class="comment"># curl -uYNbrfwcmEqnuJD6BZthuWZP9bTJQuYmW:88DzY3WQ51Q2Q9FfWJKrTaQpLUgSfeWP localhost:15672/api/overview</span></span><br><span class="line">&#123;<span class="string">&quot;management_version&quot;</span>:<span class="string">&quot;3.8.16&quot;</span>,<span class="string">&quot;rates_mode&quot;</span>:<span class="string">&quot;basic&quot;</span>,<span class="string">&quot;sample_retention_policies&quot;</span>:&#123;<span class="string">&quot;global&quot;</span>:[600,3600,28800,86400],<span class="string">&quot;basic&quot;</span>:[600,3600],<span class="string">&quot;detailed&quot;</span>:[600]&#125;,<span class="string">&quot;exchange_types&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;direct&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;AMQP direct exchange, as per the AMQP specification&quot;</span>,<span class="string">&quot;enabled&quot;</span>:<span class="literal">true</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;fanout&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;AMQP fanout exchange, as per the AMQP specification&quot;</span>,<span class="string">&quot;enabled&quot;</span>:<span class="literal">true</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;headers&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;AMQP headers exchange, as per the AMQP specification&quot;</span>,<span class="string">&quot;enabled&quot;</span>:<span class="literal">true</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;topic&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;AMQP topic exchange, as per the AMQP specification&quot;</span>,<span class="string">&quot;enabled&quot;</span>:<span class="literal">true</span>&#125;],<span class="string">&quot;product_version&quot;</span>:<span class="string">&quot;3.8.16&quot;</span>,<span class="string">&quot;product_name&quot;</span>:<span class="string">&quot;RabbitMQ&quot;</span>,<span class="string">&quot;rabbitmq_version&quot;</span>:<span class="string">&quot;3.8.16&quot;</span>,<span class="string">&quot;cluster_name&quot;</span>:<span class="string">&quot;my-rabbit-cluster&quot;</span>,<span class="string">&quot;erlang_version&quot;</span>:<span class="string">&quot;24.0.2&quot;</span>,<span class="string">&quot;erlang_full_version&quot;</span>:<span class="string">&quot;Erlang/OTP 24 [erts-12.0.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1]&quot;</span>,<span class="string">&quot;disable_stats&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;enable_queue_totals&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;message_stats&quot;</span>:&#123;&#125;,<span class="string">&quot;churn_rates&quot;</span>:&#123;<span class="string">&quot;channel_closed&quot;</span>:0,<span class="string">&quot;channel_closed_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;channel_created&quot;</span>:0,<span class="string">&quot;channel_created_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;connection_closed&quot;</span>:60,<span class="string">&quot;connection_closed_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;connection_created&quot;</span>:0,<span class="string">&quot;connection_created_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;queue_created&quot;</span>:0,<span class="string">&quot;queue_created_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;queue_declared&quot;</span>:0,<span class="string">&quot;queue_declared_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;,<span class="string">&quot;queue_deleted&quot;</span>:0,<span class="string">&quot;queue_deleted_details&quot;</span>:&#123;<span class="string">&quot;rate&quot;</span>:0.0&#125;&#125;,<span class="string">&quot;queue_totals&quot;</span>:&#123;&#125;,<span class="string">&quot;object_totals&quot;</span>:&#123;<span class="string">&quot;channels&quot;</span>:0,<span class="string">&quot;connections&quot;</span>:0,<span class="string">&quot;consumers&quot;</span>:0,<span class="string">&quot;exchanges&quot;</span>:7,<span class="string">&quot;queues&quot;</span>:0&#125;,<span class="string">&quot;statistics_db_event_queue&quot;</span>:0,<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;listeners&quot;</span>:[&#123;<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;amqp&quot;</span>,<span class="string">&quot;ip_address&quot;</span>:<span class="string">&quot;::&quot;</span>,<span class="string">&quot;port&quot;</span>:5672,<span class="string">&quot;socket_opts&quot;</span>:&#123;<span class="string">&quot;backlog&quot;</span>:128,<span class="string">&quot;nodelay&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;linger&quot;</span>:[<span class="literal">true</span>,0],<span class="string">&quot;exit_on_close&quot;</span>:<span class="literal">false</span>&#125;&#125;,&#123;<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;clustering&quot;</span>,<span class="string">&quot;ip_address&quot;</span>:<span class="string">&quot;::&quot;</span>,<span class="string">&quot;port&quot;</span>:25672,<span class="string">&quot;socket_opts&quot;</span>:[]&#125;,&#123;<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;http&quot;</span>,<span class="string">&quot;ip_address&quot;</span>:<span class="string">&quot;::&quot;</span>,<span class="string">&quot;port&quot;</span>:15672,<span class="string">&quot;socket_opts&quot;</span>:&#123;<span class="string">&quot;cowboy_opts&quot;</span>:&#123;<span class="string">&quot;sendfile&quot;</span>:<span class="literal">false</span>&#125;,<span class="string">&quot;port&quot;</span>:15672&#125;&#125;,&#123;<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;http/prometheus&quot;</span>,<span class="string">&quot;ip_address&quot;</span>:<span class="string">&quot;::&quot;</span>,<span class="string">&quot;port&quot;</span>:15692,<span class="string">&quot;socket_opts&quot;</span>:&#123;<span class="string">&quot;cowboy_opts&quot;</span>:&#123;<span class="string">&quot;sendfile&quot;</span>:<span class="literal">false</span>&#125;,<span class="string">&quot;port&quot;</span>:15692,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;http/prometheus&quot;</span>&#125;&#125;],<span class="string">&quot;contexts&quot;</span>:[&#123;<span class="string">&quot;ssl_opts&quot;</span>:[],<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;RabbitMQ Management&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;cowboy_opts&quot;</span>:<span class="string">&quot;[&#123;sendfile,false&#125;]&quot;</span>,<span class="string">&quot;port&quot;</span>:<span class="string">&quot;15672&quot;</span>&#125;,&#123;<span class="string">&quot;ssl_opts&quot;</span>:[],<span class="string">&quot;node&quot;</span>:<span class="string">&quot;rabbit@my-rabbit-cluster-server-0.my-rabbit-cluster-nodes.default&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;RabbitMQ Prometheus&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;cowboy_opts&quot;</span>:<span class="string">&quot;[&#123;sendfile,false&#125;]&quot;</span>,<span class="string">&quot;port&quot;</span>:<span class="string">&quot;15692&quot;</span>,<span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;&#x27;http/prometheus&#x27;&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>6）设置应用访问 RabbitMQ 集群</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># username=&quot;$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.username&#125;&#x27; | base64 --decode)&quot;</span></span><br><span class="line"><span class="comment"># password=&quot;$(kubectl get secret my-rabbit-cluster-default-user -n rabbitmq-system -o jsonpath=&#x27;&#123;.data.password&#125;&#x27; | base64 --decode)&quot;</span></span><br><span class="line"><span class="comment"># service=&quot;$(kubectl get service my-rabbit-cluster -n rabbitmq-system -o jsonpath=&#x27;&#123;.spec.clusterIP&#125;&#x27;)&quot;</span></span><br><span class="line"><span class="comment"># kubectl run perf-test --image=pivotalrabbitmq/perf-test -- --uri amqp://$username:$password@$service</span></span><br><span class="line"></span><br><span class="line">pod/perf-test created</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl logs --follow perf-test</span></span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 1.000s, sent: 4720 msg/s, received: 2109 msg/s, min/median/75th/95th/99th consumer latency: 3075/22253/33855/75681/89195 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 2.000s, sent: 16538 msg/s, received: 13698 msg/s, min/median/75th/95th/99th consumer latency: 91432/157833/203565/344737/356844 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 3.001s, sent: 18142 msg/s, received: 17832 msg/s, min/median/75th/95th/99th consumer latency: 268145/343634/378988/437575/450074 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 4.001s, sent: 20991 msg/s, received: 17456 msg/s, min/median/75th/95th/99th consumer latency: 264207/345566/373946/407531/425332 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 5.015s, sent: 24398 msg/s, received: 13231 msg/s, min/median/75th/95th/99th consumer latency: 358486/701769/755296/803202/832797 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 6.017s, sent: 14616 msg/s, received: 12665 msg/s, min/median/75th/95th/99th consumer latency: 834423/1083012/1225606/1335011/1374533 µs</span><br><span class="line"><span class="built_in">id</span>: test-041921-512, time: 7.019s, sent: 16229 msg/s, received: 14603 msg/s, min/median/75th/95th/99th consumer latency: 1335783/1502060/1614123/1700792/1742414 µs</span><br><span class="line">可以看出，perf-test每秒能够产生和消耗大约12000条消息。</span><br></pre></td></tr></table></figure>

<h3 id="RabbitMQ-监控"><a href="#RabbitMQ-监控" class="headerlink" title="RabbitMQ 监控"></a>RabbitMQ 监控</h3><p>**使用 Prometheus &amp; Grafana 监控 rabbitmq 集群，可参考 **<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/prometheus.html">官方文档地址</a></p>
<p>注意：当扩充增加到 2 个甚至更多的时候，需要 k8s 节点资源是否足够。如报错：<code>0/3 nodes are available: 3 Insufficient cpu.</code> 原因是 k8s 节点资源资源不足。<br>1）创建 rabbitmq 集群时使用的是默认配置，默认配置中资源要求如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Limits:</span></span><br><span class="line">  <span class="attr">cpu:</span>     <span class="number">2</span></span><br><span class="line">  <span class="attr">memory:</span>  <span class="string">2Gi</span></span><br><span class="line"><span class="attr">Requests:</span></span><br><span class="line">  <span class="attr">cpu:</span>      <span class="number">1</span></span><br><span class="line">  <span class="attr">memory:</span>   <span class="string">2Gi</span></span><br></pre></td></tr></table></figure>

<p>2）自动生成第二个 pod 时查看的详情如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Name:           my-rabbit-cluster-server-1</span><br><span class="line">Namespace:      rabbitmq-system</span><br><span class="line">Priority:       0</span><br><span class="line">Node:           &lt;none&gt;</span><br><span class="line">Labels:         app.kubernetes.io/component=rabbitmq</span><br><span class="line">                app.kubernetes.io/name=my-rabbit-cluster</span><br><span class="line">                app.kubernetes.io/part-of=rabbitmq</span><br><span class="line">                controller-revision-hash=my-rabbit-cluster-server-b7d484587</span><br><span class="line">                statefulset.kubernetes.io/pod-name=my-rabbit-cluster-server-1</span><br><span class="line">Annotations:    prometheus.io/port: 15692</span><br><span class="line">                prometheus.io/scrape: <span class="literal">true</span></span><br><span class="line">Status:         Pending</span><br><span class="line">IP:             </span><br><span class="line">IPs:            &lt;none&gt;</span><br><span class="line">Controlled By:  StatefulSet/my-rabbit-cluster-server</span><br><span class="line">Init Containers:</span><br><span class="line">  setup-container:</span><br><span class="line">    Image:      rabbitmq:3.8.16-management</span><br><span class="line">    Port:       &lt;none&gt;</span><br><span class="line">    Host Port:  &lt;none&gt;</span><br><span class="line">    Command:</span><br><span class="line">      sh</span><br><span class="line">      -c</span><br><span class="line">      <span class="built_in">cp</span> /tmp/erlang-cookie-secret/.erlang.cookie /var/lib/rabbitmq/.erlang.cookie &amp;&amp; <span class="built_in">chown</span> 999:999 /var/lib/rabbitmq/.erlang.cookie &amp;&amp; <span class="built_in">chmod</span> 600 /var/lib/rabbitmq/.erlang.cookie ; <span class="built_in">cp</span> /tmp/rabbitmq-plugins/enabled_plugins /operator/enabled_plugins &amp;&amp; <span class="built_in">chown</span> 999:999 /operator/enabled_plugins ; <span class="built_in">chown</span> 999:999 /var/lib/rabbitmq/mnesia/ ; <span class="built_in">echo</span> <span class="string">&#x27;[default]&#x27;</span> &gt; /var/lib/rabbitmq/.rabbitmqadmin.conf &amp;&amp; sed -e <span class="string">&#x27;s/default_user/username/&#x27;</span> -e <span class="string">&#x27;s/default_pass/password/&#x27;</span> /tmp/default_user.conf &gt;&gt; /var/lib/rabbitmq/.rabbitmqadmin.conf &amp;&amp; <span class="built_in">chown</span> 999:999 /var/lib/rabbitmq/.rabbitmqadmin.conf &amp;&amp; <span class="built_in">chmod</span> 600 /var/lib/rabbitmq/.rabbitmqadmin.conf</span><br><span class="line">    Limits:</span><br><span class="line">      cpu:     100m</span><br><span class="line">      memory:  500Mi</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:        100m</span><br><span class="line">      memory:     500Mi</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /operator from rabbitmq-plugins (rw)</span><br><span class="line">      /tmp/default_user.conf from rabbitmq-confd (rw,path=<span class="string">&quot;default_user.conf&quot;</span>)</span><br><span class="line">      /tmp/erlang-cookie-secret/ from erlang-cookie-secret (rw)</span><br><span class="line">      /tmp/rabbitmq-plugins/ from plugins-conf (rw)</span><br><span class="line">      /var/lib/rabbitmq/ from rabbitmq-erlang-cookie (rw)</span><br><span class="line">      /var/lib/rabbitmq/mnesia/ from persistence (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from my-rabbit-cluster-server-token-vgvp4 (ro)</span><br><span class="line">Containers:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    Image:       rabbitmq:3.8.16-management</span><br><span class="line">    Ports:       4369/TCP, 5672/TCP, 15672/TCP, 15692/TCP</span><br><span class="line">    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP</span><br><span class="line">    Limits:</span><br><span class="line">      cpu:     2</span><br><span class="line">      memory:  2Gi</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:      1</span><br><span class="line">      memory:   2Gi</span><br><span class="line">    Readiness:  tcp-socket :amqp delay=10s <span class="built_in">timeout</span>=5s period=10s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">    Environment:</span><br><span class="line">      MY_POD_NAME:                    my-rabbit-cluster-server-1 (v1:metadata.name)</span><br><span class="line">      MY_POD_NAMESPACE:               default (v1:metadata.namespace)</span><br><span class="line">      RABBITMQ_ENABLED_PLUGINS_FILE:  /operator/enabled_plugins</span><br><span class="line">      K8S_SERVICE_NAME:               my-rabbit-cluster-nodes</span><br><span class="line">      RABBITMQ_USE_LONGNAME:          <span class="literal">true</span></span><br><span class="line">      RABBITMQ_NODENAME:              rabbit@$(MY_POD_NAME).$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)</span><br><span class="line">      K8S_HOSTNAME_SUFFIX:            .$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)</span><br><span class="line">    Mounts:</span><br><span class="line">      /etc/pod-info/ from pod-info (rw)</span><br><span class="line">      /etc/rabbitmq/conf.d/10-operatorDefaults.conf from rabbitmq-confd (rw,path=<span class="string">&quot;operatorDefaults.conf&quot;</span>)</span><br><span class="line">      /etc/rabbitmq/conf.d/11-default_user.conf from rabbitmq-confd (rw,path=<span class="string">&quot;default_user.conf&quot;</span>)</span><br><span class="line">      /etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf from rabbitmq-confd (rw,path=<span class="string">&quot;userDefinedConfiguration.conf&quot;</span>)</span><br><span class="line">      /operator from rabbitmq-plugins (rw)</span><br><span class="line">      /var/lib/rabbitmq/ from rabbitmq-erlang-cookie (rw)</span><br><span class="line">      /var/lib/rabbitmq/mnesia/ from persistence (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from my-rabbit-cluster-server-token-vgvp4 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status</span><br><span class="line">  PodScheduled   False </span><br><span class="line">Volumes:</span><br><span class="line">  persistence:</span><br><span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim <span class="keyword">in</span> the same namespace)</span><br><span class="line">    ClaimName:  persistence-my-rabbit-cluster-server-1</span><br><span class="line">    ReadOnly:   <span class="literal">false</span></span><br><span class="line">  plugins-conf:</span><br><span class="line">    Type:      ConfigMap (a volume populated by a ConfigMap)</span><br><span class="line">    Name:      my-rabbit-cluster-plugins-conf</span><br><span class="line">    Optional:  <span class="literal">false</span></span><br><span class="line">  rabbitmq-confd:</span><br><span class="line">    Type:                Projected (a volume that contains injected data from multiple sources)</span><br><span class="line">    SecretName:          my-rabbit-cluster-default-user</span><br><span class="line">    SecretOptionalName:  &lt;nil&gt;</span><br><span class="line">    ConfigMapName:       my-rabbit-cluster-server-conf</span><br><span class="line">    ConfigMapOptional:   &lt;nil&gt;</span><br><span class="line">  rabbitmq-erlang-cookie:</span><br><span class="line">    Type:       EmptyDir (a temporary directory that shares a pod<span class="string">&#x27;s lifetime)</span></span><br><span class="line"><span class="string">    Medium:     </span></span><br><span class="line"><span class="string">    SizeLimit:  &lt;unset&gt;</span></span><br><span class="line"><span class="string">  erlang-cookie-secret:</span></span><br><span class="line"><span class="string">    Type:        Secret (a volume populated by a Secret)</span></span><br><span class="line"><span class="string">    SecretName:  my-rabbit-cluster-erlang-cookie</span></span><br><span class="line"><span class="string">    Optional:    false</span></span><br><span class="line"><span class="string">  rabbitmq-plugins:</span></span><br><span class="line"><span class="string">    Type:       EmptyDir (a temporary directory that shares a pod&#x27;</span>s lifetime)</span><br><span class="line">    Medium:     </span><br><span class="line">    SizeLimit:  &lt;<span class="built_in">unset</span>&gt;</span><br><span class="line">  pod-info:</span><br><span class="line">    Type:  DownwardAPI (a volume populated by information about the pod)</span><br><span class="line">    Items:</span><br><span class="line">      metadata.labels[<span class="string">&#x27;skipPreStopChecks&#x27;</span>] -&gt; skipPreStopChecks</span><br><span class="line">  my-rabbit-cluster-server-token-vgvp4:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  my-rabbit-cluster-server-token-vgvp4</span><br><span class="line">    Optional:    <span class="literal">false</span></span><br><span class="line">QoS Class:       Burstable</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists <span class="keyword">for</span> 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute op=Exists <span class="keyword">for</span> 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                From               Message</span><br><span class="line">  ----     ------            ----               ----               -------</span><br><span class="line">  Warning  FailedScheduling  33s (x2 over 33s)  default-scheduler  0/3 nodes are available: 3 Insufficient cpu.</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">YuiKuen.Yuen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.yuikuen.top/2022/04/07/operator/operator部署_RabbitMQ Cluster(官方示例)/">https://blog.yuikuen.top/2022/04/07/operator/operator部署_RabbitMQ Cluster(官方示例)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/rabbitmq/">rabbitmq</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/qq-s.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wechat-s.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-624e4db30419cf74" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/04/07/operator/operator%E9%83%A8%E7%BD%B2_Redis-Cluster/"><i class="fa fa-chevron-left">  </i><span>Operator部署_Redis-Cluster</span></a></div><div class="next-post pull-right"><a href="/2022/04/07/operator/operator%E9%83%A8%E7%BD%B2_Kube-Prometheus/"><span>Operator部署_Kube-Prometheus</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'false' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'51vOu1zj5thMsDwfiYj0Gr34-gzGzoHsz',
  appKey:'XPMz9Uun0aSLDkHrDVAlmy8Q',
  placeholder:'Please enter your opinion',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wallhaven-wqx3e7-tuya.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By YuiKuen.Yuen</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://blog.yuikuen.top/">blog</a>!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="true"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>