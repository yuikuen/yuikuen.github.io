<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="CentOS7部署_Gerrit3.4.x"><meta name="keywords" content="gerrit"><meta name="author" content="YuiKuen.Yuen"><meta name="copyright" content="YuiKuen.Yuen"><title>CentOS7部署_Gerrit3.4.x | Mr.Yuen'Blog</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/favicon.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1359876433997feef3afed2ab6c5b39c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Gerrit"><span class="toc-number">3.</span> <span class="toc-text">安装 Gerrit</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/20220407100042.png"></div><div class="author-info__name text-center">YuiKuen.Yuen</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/yuikuen">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">149</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">64</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">30</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com">Molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wallhaven-wqx3e7-tuya.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Mr.Yuen'Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">CentOS7部署_Gerrit3.4.x</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-07</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/tools/">tools</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.1k</span><span class="post-meta__separator">|</span><span>Reading time: 10 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><p>本文使用 ESXI 虚拟机进行实验；</p>
<ul>
<li>2核 CPU，5GB 内存，50GB 硬盘，IP：188.188.3.144</li>
<li>CentOS 7.9 最小化安装</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.gerritcodereview.com/">Gerrit</a> 支持多种数据库、多种认证方式（参考<a target="_blank" rel="noopener" href="https://gerrit-documentation.storage.googleapis.com/Documentation/3.4.1/install.html">官网手册</a>），这里使用</p>
<ul>
<li>mariadb数据库</li>
<li>http认证</li>
<li>Apache http server 作为 web 服务器，提供反向代理</li>
<li>gitweb 作为 Repository Browser</li>
</ul>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p>1）安装依赖环境</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum -y install git gitweb httpd java-11-openjdk java-11-openjdk-devel</span><br></pre></td></tr></table></figure>

<p>2）配置 httpd 反向代理</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/httpd/conf.d/gerrit.conf</span><br><span class="line">&lt;VirtualHost *&gt;                        <span class="comment"># 可自定义端口，默认80</span></span><br><span class="line">    ServerName 188.188.3.144           <span class="comment"># 此为服务器IP地址</span></span><br><span class="line"></span><br><span class="line">    ProxyRequests Off</span><br><span class="line">    ProxyVia Off</span><br><span class="line">    ProxyPreserveHost On</span><br><span class="line"></span><br><span class="line">    &lt;Proxy *&gt;</span><br><span class="line">          Order deny,allow</span><br><span class="line">          Allow from all</span><br><span class="line">    &lt;/Proxy&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Location /login/&gt;</span><br><span class="line">      AuthType Basic</span><br><span class="line">      AuthName <span class="string">&quot;Gerrit Code Review&quot;</span></span><br><span class="line">      AuthBasicProvider file</span><br><span class="line">      AuthUserFile /gerrit.passwd      <span class="comment"># 此处基于文件方式认证，详细查看‘添加HTTP认证用户’         </span></span><br><span class="line">      Require valid-user</span><br><span class="line">    &lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">    AllowEncodedSlashes On</span><br><span class="line">    ProxyPass / http://127.0.0.1:8081/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">$ systemctl <span class="built_in">enable</span> --now httpd</span><br></pre></td></tr></table></figure>

<ul>
<li>ServerName 根据自己实际情况自定义，此为本机 IP</li>
<li>Gerrit 的 http 认证方式，需要使用 HTTP 基本认证（httpd 要有访问权限才行，在此使用文件 <code>/gerrit.passwd</code>）方式认证</li>
<li>反向代理设置，从根目录”&#x2F;“，代理到”<a target="_blank" rel="noopener" href="http://127.0.0.1:8081/&quot;%EF%BC%88%E6%B3%A8%E6%84%8F%E7%AB%AF%E5%8F%A3%E5%90%8E%E7%9A%84%E6%96%9C%E7%BA%BF%EF%BC%8C8081%E4%B8%BA">http://127.0.0.1:8081/&quot;（注意端口后的斜线，8081为</a> gerrit 监听的端口）</li>
</ul>
<p>3）配置 Jre</p>
<p>注意：官网上有注明使用的先决条件，要运行 GERRIT 服务，主机必须满足以下要求：JRE，版本 1.8 或 11 下载（ Gerrit 目前尚未与 Java 13 或更新兼容）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">which</span> java</span><br><span class="line">$ <span class="built_in">ls</span> -lr /usr/bin/java</span><br><span class="line">$ <span class="built_in">ls</span> -lrt /etc/alternatives/java</span><br><span class="line"><span class="comment"># 输出/usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.el7_9.x86_64就是JAVA的安装路径</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/profile</span><br><span class="line"><span class="comment"># Java Environment</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.el7_9.x86_64</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/jre/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>4）添加 HTTP 认证用户</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> /gerrit.passwd</span><br><span class="line">$ htpasswd /gerrit.passwd <span class="string">&quot;root&quot;</span></span><br><span class="line">New password: </span><br><span class="line">Re-<span class="built_in">type</span> new password: </span><br><span class="line">Adding password <span class="keyword">for</span> user root</span><br><span class="line">$ <span class="built_in">cat</span> /gerrit.passwd </span><br><span class="line">root:$apr1$XwPU680a<span class="variable">$XX</span>/1KGJViZ4QT7NLrl2/n/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：&quot;-c&quot;参数为创建，仅限第一次添加用户时使用，第二次创建时不要加&quot;-c&quot;参数</span></span><br><span class="line"><span class="comment"># 添加一个用户</span></span><br><span class="line">$ htpasswd -c /gerrit.passwd <span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="comment"># 添加其他用户</span></span><br><span class="line">$ htpasswd -b /gerrit.passwd root passwd</span><br><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">$ htpasswd -D /gerrit.passwd root</span><br><span class="line"><span class="comment"># 更改密码</span></span><br><span class="line">$ htpasswd -m /gerrit.passwd root</span><br></pre></td></tr></table></figure>

<h3 id="安装-Gerrit"><a href="#安装-Gerrit" class="headerlink" title="安装 Gerrit"></a>安装 Gerrit</h3><p>1）下载或上传 war 包，进行安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /usr/local/gerrit &amp;&amp; <span class="built_in">cd</span> /usr/local/gerrit</span><br><span class="line">$ java -jar gerrit-3.4.1.war init -d review_site</span><br><span class="line">Using secure store: com.google.gerrit.server.securestore.DefaultSecureStore</span><br><span class="line">[2021-11-05 10:07:30,655] [main] INFO  com.google.gerrit.server.config.GerritServerConfigProvider : No /usr/local/gerrit/review_site/etc/gerrit.config; assuming defaults</span><br><span class="line"></span><br><span class="line">*** Gerrit Code Review 3.4.1</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Create <span class="string">&#x27;/usr/local/gerrit/review_site&#x27;</span> [Y/n]? y    <span class="comment"># 是否安装在此目录，选n程序自动退出，默认回车也可</span></span><br><span class="line"></span><br><span class="line">*** Git Repositories</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Location of Git repositories   [git]:              <span class="comment"># Git存储库，不指定则默认创建在程序目录./gerrit/review_site/git</span></span><br><span class="line"></span><br><span class="line">*** JGit Configuration</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Auto-configured <span class="string">&quot;receive.autogc = false&quot;</span> to <span class="built_in">disable</span> auto-gc after git-receive-pack.</span><br><span class="line"></span><br><span class="line">*** Index</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Type                           [lucene]:           <span class="comment"># 默认回车</span></span><br><span class="line"></span><br><span class="line">*** User Authentication</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Authentication method          [openid/?]: http    <span class="comment"># 认证方式http，在此使用反向代理</span></span><br><span class="line">Get username from custom HTTP header [y/N]? n      <span class="comment"># 是否自定义http头获取用户名</span></span><br><span class="line">SSO <span class="built_in">logout</span> URL                 :                   <span class="comment"># 默认回车</span></span><br><span class="line">Enable signed push support     [y/N]? y            <span class="comment"># 启用签名推送支持</span></span><br><span class="line"></span><br><span class="line">*** Review Labels</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">Install Verified label         [y/N]?              <span class="comment"># 安装已验证标签，默认回车</span></span><br><span class="line"></span><br><span class="line">*** Email Delivery</span><br><span class="line">*** </span><br><span class="line"></span><br><span class="line">SMTP server hostname           [localhost]: smtp.qq.com    <span class="comment"># smtp发送邮件服务器</span></span><br><span class="line">SMTP server port               [(default)]: 465            <span class="comment"># 465/994-SSL协议端口，25-非SSL协议端口</span></span><br><span class="line">SMTP encryption                [none/?]: SSL               <span class="comment"># 根据上述协议自行定义</span></span><br><span class="line">SMTP username                  [root]: sinath@vip.qq.com   <span class="comment"># 此为自定义自动发送邮件的地址</span></span><br><span class="line">sinath@vip.qq.com<span class="string">&#x27;s password   :                           # QQ邮箱此处为授权码，非邮箱密码，如163、企业邮箱即为密码</span></span><br><span class="line"><span class="string">              confirm password : </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** Container Process</span></span><br><span class="line"><span class="string">*** </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run as                         [root]:        # 程序运行进程的用户，默认为当前用户，可另创用户                                            </span></span><br><span class="line"><span class="string">Java runtime                   [/usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.el7_9.x86_64]: </span></span><br><span class="line"><span class="string">Copy gerrit-3.4.1.war to review_site/bin/gerrit.war [Y/n]? y</span></span><br><span class="line"><span class="string">Copying gerrit-3.4.1.war to review_site/bin/gerrit.war</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** SSH Daemon</span></span><br><span class="line"><span class="string">*** </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Listen on address              [*]:           # 指定SSH后台服务监听地址</span></span><br><span class="line"><span class="string">Listen on port                 [29418]:       # 指定SSH后台服务的端口</span></span><br><span class="line"><span class="string">Generating SSH host key ... rsa... ed25519... ecdsa 256... ecdsa 384... ecdsa 521... done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** HTTP Daemon</span></span><br><span class="line"><span class="string">*** </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Behind reverse proxy           [y/N]? y       # 开启发向代理</span></span><br><span class="line"><span class="string">Proxy uses SSL (https://)      [y/N]?         # 默认开启SSL</span></span><br><span class="line"><span class="string">Subdirectory on proxy server   [/]:           # 代理服务器的根目录，默认为“/”，默认回车</span></span><br><span class="line"><span class="string">Listen on address              [*]: 127.0.0.1 # gerrit的监听地址</span></span><br><span class="line"><span class="string">Listen on port                 [8081]:        # gerrit的服务端口</span></span><br><span class="line"><span class="string">Canonical URL                  [http://127.0.0.1/]: http://188.188.3.144  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** Cache</span></span><br><span class="line"><span class="string">*** </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** Plugins</span></span><br><span class="line"><span class="string">*** </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Installing plugins.                           # 接下来就是询问是否安装插件，一路y即可</span></span><br><span class="line"><span class="string">Install plugin codemirror-editor version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed codemirror-editor v3.4.1</span></span><br><span class="line"><span class="string">Install plugin commit-message-length-validator version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed commit-message-length-validator v3.4.1</span></span><br><span class="line"><span class="string">Install plugin delete-project version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed delete-project v3.4.1</span></span><br><span class="line"><span class="string">Install plugin download-commands version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed download-commands v3.4.1</span></span><br><span class="line"><span class="string">Install plugin gitiles version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed gitiles v3.4.1</span></span><br><span class="line"><span class="string">Install plugin hooks version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed hooks v3.4.1</span></span><br><span class="line"><span class="string">Install plugin plugin-manager version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed plugin-manager v3.4.1</span></span><br><span class="line"><span class="string">Install plugin replication version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed replication v3.4.1</span></span><br><span class="line"><span class="string">Install plugin reviewnotes version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed reviewnotes v3.4.1</span></span><br><span class="line"><span class="string">Install plugin singleusergroup version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed singleusergroup v3.4.1</span></span><br><span class="line"><span class="string">Install plugin webhooks version v3.4.1 [y/N]? y</span></span><br><span class="line"><span class="string">Installed webhooks v3.4.1</span></span><br><span class="line"><span class="string">Initializing plugins.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">============================================================================</span></span><br><span class="line"><span class="string">Welcome to the Gerrit community</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Find more information on the homepage: https://www.gerritcodereview.com</span></span><br><span class="line"><span class="string">Discuss Gerrit on the mailing list: https://groups.google.com/g/repo-discuss</span></span><br><span class="line"><span class="string">============================================================================</span></span><br><span class="line"><span class="string">Initialized /usr/local/gerrit/review_site</span></span><br><span class="line"><span class="string">Init complete, reindexing accounts with: reindex --site-path review_site --threads 1 --index accountsReindexed 0 documents in accounts index in 0.0s (0.0/s)</span></span><br><span class="line"><span class="string">Index accounts in version 11 is ready</span></span><br><span class="line"><span class="string">Warning: InterruptedException</span></span><br><span class="line"><span class="string">java.lang.InterruptedException</span></span><br><span class="line"><span class="string">	at java.base/java.lang.Object.wait(Native Method)</span></span><br><span class="line"><span class="string">	at java.base/java.lang.Thread.join(Thread.java:1308)</span></span><br><span class="line"><span class="string">	at org.h2.util.MathUtils.getSecureRandom(MathUtils.java:105)</span></span><br><span class="line"><span class="string">	at org.h2.util.MathUtils.secureRandomBytes(MathUtils.java:307)</span></span><br><span class="line"><span class="string">	at org.h2.store.FileLock.setUniqueId(FileLock.java:315)</span></span><br><span class="line"><span class="string">	at org.h2.store.FileLock.lockFile(FileLock.java:345)</span></span><br><span class="line"><span class="string">	at org.h2.store.FileLock.lock(FileLock.java:136)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Database.open(Database.java:622)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Database.openDatabase(Database.java:260)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Database.&lt;init&gt;(Database.java:254)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Engine.openSession(Engine.java:57)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Engine.openSession(Engine.java:164)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Engine.createSessionAndValidate(Engine.java:142)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Engine.createSession(Engine.java:125)</span></span><br><span class="line"><span class="string">	at org.h2.engine.Engine.createSession(Engine.java:27)</span></span><br><span class="line"><span class="string">	at org.h2.engine.SessionRemote.connectEmbeddedOrServer(SessionRemote.java:331)</span></span><br><span class="line"><span class="string">	at org.h2.jdbc.JdbcConnection.&lt;init&gt;(JdbcConnection.java:107)</span></span><br><span class="line"><span class="string">	at org.h2.jdbc.JdbcConnection.&lt;init&gt;(JdbcConnection.java:91)</span></span><br><span class="line"><span class="string">	at org.h2.Driver.connect(Driver.java:74)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.cache.h2.H2CacheImpl$SqlHandle.&lt;init&gt;(H2CacheImpl.java:679)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.cache.h2.H2CacheImpl$SqlStore.acquire(H2CacheImpl.java:647)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.cache.h2.H2CacheImpl$SqlStore.buildBloomFilter(H2CacheImpl.java:365)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.cache.h2.H2CacheImpl$SqlStore.open(H2CacheImpl.java:337)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.cache.h2.H2CacheImpl.start(H2CacheImpl.java:197)</span></span><br><span class="line"><span class="string">	at com.google.gerrit.server.logging.LoggingContextAwareRunnable.run(LoggingContextAwareRunnable.java:113)</span></span><br><span class="line"><span class="string">	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span></span><br><span class="line"><span class="string">	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)</span></span><br><span class="line"><span class="string">	at java.base/java.lang.Thread.run(Thread.java:829)</span></span><br><span class="line"><span class="string">Collecting projects:    2 changes with: reindex --site-path review_site --threads 1 --index changes</span></span><br><span class="line"><span class="string">Reindexing changes: project-slices: 100% (2/2), done    </span></span><br><span class="line"><span class="string">Reindexed 0 documents in changes index in 0.0s (0.0/s)</span></span><br><span class="line"><span class="string">Index changes in version 61 is ready</span></span><br><span class="line"><span class="string">Reindexing groups:      100% (2/2)ith: reindex --site-path review_site --threads 1 --index groups</span></span><br><span class="line"><span class="string">Reindexed 2 documents in groups index in 0.2s (12.7/s)</span></span><br><span class="line"><span class="string">Index groups in version 8 is ready</span></span><br><span class="line"><span class="string">Reindexing projects:    100% (2/2) with: reindex --site-path review_site --threads 1 --index projects</span></span><br><span class="line"><span class="string">Reindexed 2 documents in projects index in 0.1s (14.5/s)</span></span><br><span class="line"><span class="string">Index projects in version 4 is ready</span></span><br><span class="line"><span class="string">Executing /usr/local/gerrit/review_site/bin/gerrit.sh start</span></span><br><span class="line"><span class="string">Starting Gerrit Code Review: OK</span></span><br><span class="line"><span class="string">Waiting for server on 188.188.3.144:80 ... OK</span></span><br><span class="line"><span class="string">Opening http://188.188.3.144/#/admin/projects/ ...FAILED</span></span><br><span class="line"><span class="string">Open Gerrit with a JavaScript capable browser:</span></span><br><span class="line"><span class="string">  http://188.188.3.144/#/admin/projects/</span></span><br></pre></td></tr></table></figure>
<p>2）修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> ./gerrit/review_site/etc/gerrit.config</span><br><span class="line">[gerrit]</span><br><span class="line">	basePath = git</span><br><span class="line">	canonicalWebUrl = http://188.188.3.145</span><br><span class="line">	serverId = 1426be99-788d-4ee3-9c97-657e3f82b964</span><br><span class="line">[container]</span><br><span class="line">	javaOptions = <span class="string">&quot;-Dflogger.backend_factory=com.google.common.flogger.backend.log4j.Log4jBackendFactory#getInstance&quot;</span></span><br><span class="line">	javaOptions = <span class="string">&quot;-Dflogger.logging_context=com.google.gerrit.server.logging.LoggingContext#getInstance&quot;</span></span><br><span class="line">	user = root</span><br><span class="line">	javaHome = /usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.el7_9.x86_64</span><br><span class="line">[index]</span><br><span class="line">	<span class="built_in">type</span> = lucene</span><br><span class="line">[auth]</span><br><span class="line">	<span class="built_in">type</span> = HTTP</span><br><span class="line">[receive]</span><br><span class="line">	enableSignedPush = <span class="literal">true</span></span><br><span class="line">[sendemail]</span><br><span class="line">	smtpServer = smtp.qq.com</span><br><span class="line">	smtpServerPort = 465</span><br><span class="line">	smtpEncryption = SSL</span><br><span class="line">	smtpUser = sinath@vip.qq.com</span><br><span class="line">[sshd]</span><br><span class="line">	listenAddress = *:29418</span><br><span class="line">[httpd]</span><br><span class="line">	listenUrl = proxy-http://127.0.0.1:8081/</span><br><span class="line">[cache]</span><br><span class="line">	directory = cache</span><br></pre></td></tr></table></figure>
<p>3）启动并配置开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 管理命令</span></span><br><span class="line">$ ./gerrit/review_site/bin/gerrit.sh start</span><br><span class="line">$ ./gerrit/review_site/bin/gerrit.sh stop</span><br><span class="line">$ ./gerrit/review_site/bin/gerrit.sh status</span><br><span class="line"></span><br><span class="line">$ netstat -ltnp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      1725/mysqld         </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1102/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1189/master         </span><br><span class="line">tcp6       0      0 :::29418                :::*                    LISTEN      4406/GerritCodeRevi </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      1783/httpd          </span><br><span class="line">tcp6       0      0 127.0.0.1:8081          :::*                    LISTEN      4406/GerritCodeRevi </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1102/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1189/master</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/systemd/system/gerrit.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=gerrit Server</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/gerrit/review_site/bin/gerrit.sh start</span><br><span class="line">ExecStop=/usr/local/gerrit/review_site/bin/gerrit.sh stop</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"> </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>4）登录验证 <a target="_blank" rel="noopener" href="http://server-ip/">http://server-ip</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/image-20211104151058542.png" alt="image-20211104151058542.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/image-20211104151110402.png" alt="image-20211104151110402"></p>
<p><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/image-20211105104049204.png" alt="image-20211105104049204"></p>
<p><img src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/image-20211105114258300.png" alt="image-20211105114258300"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">YuiKuen.Yuen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.yuikuen.top/2022/04/07/tools/centos7部署_Gerrit3.4.x/">https://blog.yuikuen.top/2022/04/07/tools/centos7部署_Gerrit3.4.x/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/gerrit/">gerrit</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/qq-s.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wechat-s.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-624e4db30419cf74" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/04/07/tools/centos7%E9%83%A8%E7%BD%B2_Glpi%E8%B5%84%E4%BA%A7%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F/"><i class="fa fa-chevron-left">  </i><span>CentOS7部署_Glpi资产信息系统</span></a></div><div class="next-post pull-right"><a href="/2022/04/07/ubuntu/ubuntu%E9%85%8D%E7%BD%AE_%E6%8C%82%E8%BD%BD%E6%96%B0%E7%A1%AC%E7%9B%98/"><span>Ubuntu配置_挂载新硬盘</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'false' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'51vOu1zj5thMsDwfiYj0Gr34-gzGzoHsz',
  appKey:'XPMz9Uun0aSLDkHrDVAlmy8Q',
  placeholder:'Please enter your opinion',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/yuikuen/picgo-cdn_images/img/wallhaven-wqx3e7-tuya.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By YuiKuen.Yuen</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://blog.yuikuen.top/">blog</a>!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="true"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>